
resources:
  containers:
  - container: lib7842image
    image: 'theol0403/lib7842-image:latest'

jobs:
- job: BuildTemplate
  timeoutInMinutes: 5

  pool:
    vmImage: 'ubuntu-latest'
  container: lib7842image

  steps:

  # checkout repo
  - checkout: self

  # make template
  - bash: |
      make
      make template
      mkdir -p artifacts
      cp *.zip artifacts
    displayName: Build Template
  # publish template
  - task: PublishPipelineArtifact@0
    inputs:
      targetPath: artifacts
      artifactName: template
    condition: succeeded()
    displayName: "Publish Template"

  # make
  - bash: |
      make
    displayName: Build Arm Binaries

- job: Test
  timeoutInMinutes: 5
  dependsOn: BuildTemplate

  pool:
    vmImage: 'ubuntu-latest'
  container: lib7842image

  steps:

  - bash: |
      git submodule update --init --recursive
    displayName: Checkout Submodules

  # build google
  - bash: |
      cd test/googletest/
      cmake .
      make
    displayName: Build GoogleTest

  # build tests
  - bash: |
      cd test/
      make
    displayName: Build Tests

  # run tests
  - bash: |
      cd test/
      ./bin/main.exe
    displayName: Run Tests

